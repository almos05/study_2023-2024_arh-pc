---
## Front matter
title: "Отчёт по лабораторной работе №9"
subtitle: "Дисциплина: Архитектура компьютера"
author: "Мосолов Александр Денисович"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
lot: true # List of tables
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
## Biblatex
biblatex: true
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lotTitle: "Список таблиц"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

<p>Приобретение навыков написания программ с использованием подпрограмм. Знакомство с методами отладки при помощи GDB и его основными возможностями.</p>

# Выполнение лабораторной работы

## Реализация подпрограмм в NASM

<p>С помощью *mkdir* создаем директорию, в которой будем работать во время выполнения лабораторной работы №9. Переходим в созданный каталог. С помощью touch создаем файл *lab09-1.asm.*</p>

![Создание каталога для работы](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-08 23-10-26.png){ #fig:001 width=70% }

<p>Внимательно изучив текст программы из листинга *9.1*, вводим его в файл *lab09-1.asm.*</p>

![Текст программы lab09-1](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-08 23-31-39.png){ #fig:002 width=70% }

<p>Далее создаем исполняемый файл и запускаем его.</p>

![Создание исполняемого файла](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-08 23-26-04.png){ #fig:003 width=70% }

<p>Изменим текст программы, добавив подпрограмму _subcalcul в подпрограмму _calcul, для вычисления выражения *f(g(x))*, где x вводится с клавиатуры, *f(x) = 2x + 7, g(x) = 3x − 1*.</p>

![Текст изменённой программы lab09-1](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-08 23-42-04.png){ #fig:004 width=70% }

<p>Далее создаем исполняемый файл и запускаем его.</p>

![Создание испольняемого файла обновленной программы](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-08 23-41-39.png){ #fig:005 width=70% }

## Отладка программам с помощью GDB

<p>Создаем файл *lab09-2.asm* в каталоге с помощью команды *touch lab09-2.asm*.</p>

<p>Открываем файл и заполняем его в соответствии с листингом *9.2*.</p>

![Текст программы lab09-2](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-08 23-45-52.png){ #fig:006 width=70% }

<p>Получим исполняемый файл. Для работы с *GDB* в исполняемый файл необходимо добавить отладочную информацию, для этого трансляцию программ необходимо проводить с ключом *‘-g’*.</p>

![Получение исполняемого файла lab09-2](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-08 23-45-32.png){ #fig:007 width=70% }

<p>Загрузим исполняемый файл в отладчик *GDB*.</p>

![Загрузка исполняемого файла в отладчик GDB](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-08 23-47-06.png){ #fig:008 width=70% }

<p>Проверим работу программы, запустив ее в оболочке *GDB* с помощью команды *run*.</p>

![Проверка работы программы в оболочке GDB](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-08 23-48-51.png){#fig:009 width=70%}

<p>Для более подробного анализа программы установим брейкпоинт на метку _start, с которой начинается выполнение любой ассемблерной программы, и запустим её.</p>

![Запуск программы с брэйкпоинтом на метке _start](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-08 23-51-27.png){#fig:010 width=70%}

<p>Посмотрим дисассимилированный код программы с помощью команды disassemble начиная с метки _start.</p>
![Дисассимилированный код программы](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-08 23-52-52.png){#fig:011 width=70%}

<p>Переключимся на отображение команд с *Intel’овским синтаксисом*, введя команду *set disassembly-flavor intel*.</p>

![Intel'овский синтаксис](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-08 23-54-39.png){#fig:012 width=70%}

Различия отображения синтаксиса машинных команд в режимах ATT и Intel:

1. Разделители операндов также различаются: в ATT синтаксисе используются запятые, в то время как в Intel синтаксисе могут применяться запятые или косые черты (/).
2. В ATT синтаксисе порядок операндов отличается от Intel: исходный операнд указывается первым, а результирующий - вторым, в то время как в Intel синтаксисе порядок обычно прямой, с результирующим операндом первым и исходным операндом вторым.
3. Адреса в ATT синтаксисе указываются в круглых скобках, в то время как в Intel синтаксисе адреса указываются без скобок.
4. Префиксы размера операндов: В ATT синтаксисе размер операнда указывается перед операндом с использованием префиксов, таких как “b” (byte), “w” (word), “l” (long) и “q” (quadword). В Intel синтаксисе размер операнда указывается после операнда с использованием суффиксов, таких как “b”, “w”, “d” и “q”.
5. Знак операндов: В ATT синтаксисе операнды с позитивными значениями предваряются символом “$". В Intel синтаксисе операнды с позитивными значениями могут быть указаны без символа "$”.


<p>Включим режим псевдографики для более удобного анализа программы.</p>

![Режим псевдографики №1](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-08 23-55-11.png){#fig:013 width=70%}

![Режим псевдографики №2](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-08 23-55-27.png){#fig:014 width=70%}

### Добавление точек останова

<p>Проверим установленные точки останова с помощью команды *info breakpoints*.</p>

![Информация о точках останова](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-08 23-59-00.png){#fig:015 width=70%}

<p>Определим адрес предпоследней инструкции *(mov ebx,0x0)* и установим точку останова.</p>

![Установка точки останова](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 00-00-24.png){#fig:016 width=70%}

<p>Посмотрим информацию о всех установленных точках останова.</p>

![Информация о точках останова](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 00-00-52.png){#fig:017 width=70%}

### Работа с данными программы в GDB

<p>Выполним 5 инструкций *stepi*.</p>

![Выполнение 5 инструкций stepi](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 04-42-33.png){#fig:018 width=70%}

<p>Посмотрев содержимое регистров с помощью команды *info registers* (или *i r*), понимаем, что во время выполнения команд менялись регистры: *ebx, ecx, edx, eax, eip*.</p>

![Информация о регистрах](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 00-22-42.png){#fig:019 width=70%}

<p>С помощью команды x &<имя переменной> также можно посмотреть содержимое переменной. Просмотрим значение переменной *msg1* по имени и изменим первый символ слова на *h*.</p>

![Изменяем первого символа переменной msg1](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 00-25-49.png){#fig:020 width=70%}

<p>Можно смотреть значение пременой не только по имени, но и по адресу в памяти.</p>

<p>Поменяем первый символ слова переменной *msg2* на *W*.</p>

![Изменяем первого символа переменной msg2](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 00-30-06.png){#fig:021 width=70%}

<p>Выведем в различных форматах (в шестнадцатеричном формате, в двоичном формате и в символьном виде) значение регистра *edx*.</p>

![Выводим значение регистра edx](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 00-31-37.png){#fig:022 width=70%}

<p>Изменим регистр ebx.</p>

![Изменение регистра ebx](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 00-35-21.png){#fig:023 width=70%}

<p>Выводятся разные значения, команда без кавычек присваивает регистру вводимое значение.</p>

<p>Завершим выполнение программы с помощью команды continue (сокращенно c).</p>

![Завершение программы](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 00-38-44.png){#fig:024 width=70%}

<p>Выйдем из *GDB* с помощью команды *quit* (сокращенно *q*).</p>

![Выход из GDB](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 00-40-15.png){#fig:025 width=70%}

### Обработка аргументов командной строки в GDB

<p>Скопируем файл *lab8-2.asm*, созданный при выполнении лабораторной работы *№8*, с программой выводящей на экран аргументы командной строки (Листинг *8.2*) в файл с именем *lab09-3.asm*. И создадим исполняемый файл.</p>

![Копирование и создание исполняемого файла](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 00-41-58.png){#fig:026 width=70%}

<p>Загрузим исполняемый файл в отладчик, указав ключ *--args* и аргументы.</p>

![Загрузка исполняемого файла в отладчик](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 00-42-24.png){#fig:027 width=70%}

<p>Для начала установим точку останова перед первой инструкцией в программе и запустим ее.</p>

![Установка точки останова и запуск программы](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 00-43-14.png){#fig:028 width=70%}

<p>Адрес вершины стека храниться в регистре esp и по этому адресу располагается число равное количеству аргументов командной строки (включая имя программы).</p>

![Адрес вершины стека](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 00-44-22.png){#fig:029 width=70%}

<p>Просмотрим остальные позиции стека.</p>

![Просмотр остальных позиций стека](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 00-46-29.png){#fig:030 width=70%}

<p>Шаг изменения адреса равен 4, т.к. в большинстве архитектур процессоров размер слова (или размер указателя) составляет 4 байта. Это означает, что каждый раз, когда мы обращаемся к следующему элементу в стеке, мы увеличиваем адрес на 4. Шаг изменения адреса равен 4 для обеспечения корректного доступа к данным в стеке.</p>

## Выполнение заданий для самостоятельной работы

<p>Преобразуем программу из лабораторной работы *№8* (Задание *№1* для самостоятельной работы), реализовав вычисление значения функции *f(x)* как подпрограмму.</p>

<p>Создаем файл для выполнения задания с помощью команды *touch lab09-4.asm*.</p>

<p>Вставим и отредактируем текст программы из лабораторной работы №8 с добавлением подпрограммы.</p>

![Текст отредактированной программы](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 01-46-57.png){#fig:031 width=70%}

<p>Далее создаем исполняемый файл и запускаем его.</p>

![Создание и запуск исполняемого файла lab09-4](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 01-45-33.png){ #fig:032 width=70% }

<p>В листинге *9.3* приведена программа вычисления выражения *(3 + 2) * 4 + 5*. При запуске данная программа дает неверный результат. Проверьте это. С помощью отладчика *GDB*, анализируя изменения значений регистров, определите ошибку и исправьте ее.</p>

<p>Создаем файл для выполнения задания с помощью команды *touch lab09-5.asm*.</p>

<p>Вставим программу из листинга *9.3*.</p>

![Текст программы листинга 9.3](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 02-07-20.png){#fig:033 width=70%}

<p>Создаем исполняемый файл и запускаем его в отладчике *GDB*. Смотрим на изменение регистров по ходу программы.</p>

![Загрузка файла в отладчик](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 02-21-32.png){#fig:034 width=70%}

<p>Запустим программу с помощью *run*.</p>

![Запуск программы](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 02-24-50.png){#fig:043 width=70%}

<p>Смотрим изменение регистров.</p>

![Изменение регистров](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 03-28-49.png){#fig:044 width=70%}

<p>Корректируем программу, обнаружив ошибку неправильной записи регистров.</p>

![Текст изменённой программы lab09-5](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 03-34-20.png){#fig:045 width=70%}

<p>Далее создаем исполняемый файл и запускаем его, проверяем правильность выполненной программы.</p>

![Создание и запуск исполняемого файла](/home/admosolov/work/study/2023-2024/Архитектура компьютера/arch-pc/labs/lab09/report/image/Снимок экрана от 2023-12-09 03-33-13.png){ #fig:046 width=70% }

# Выводы

<p>В ходе выполнения лабораторной работы мы приобрели навыки написания программ с использованием подпрограмм, познакомились с методами отладки при помощи *GDB*.</p>
